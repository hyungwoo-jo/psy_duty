<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PSY 당직표</title>
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <header>
      <h1>PSY 당직표</h1>
    </header>

    <section class="controls">
      <div class="field">
        <label for="start-date">시작일</label>
        <input id="start-date" type="date" />
      </div>
      <div class="field">
        <label for="end-date">종료일</label>
        <input id="end-date" type="date" />
      </div>
      <div class="field">
        <label for="weeks">주 수(종료일 미지정 시)</label>
        <input id="weeks" type="number" min="1" max="8" value="4" />
      </div>
      <div class="field">
        <label for="retry-attempts">재시도 횟수</label>
        <input id="retry-attempts" type="number" min="1" max="50" value="20" />
      </div>
      
      <!-- 당직 인원 고정: 병당 1, 응당 1 (UI 옵션 제거) -->
      <div class="field field--full">
        <label for="employees">근무자 목록</label>
        <textarea id="employees" rows="12" placeholder="형식 예시:
R1 장주만
R1 조형우
R2 김대근
R2 김진아
R2 이수연
R3 권지영, 소아
R3 김선민
R3 윤준성
R4 김지영
R4 김현태
R4 이동인"></textarea>
      </div>
      <script>
        // 초기 기본 근무자: 고정 12인 + 연차 라벨(R1~R4)
        window.addEventListener('DOMContentLoaded', () => {
          const el = document.querySelector('#employees');
          if (el) el.value = [
            'R1 윤성민',
            'R1 장주만',
            'R1 조형우',
            'R2 김대근',
            'R2 김진아',
            'R2 이수연',
            'R3 권지영, 소아',
            'R3 김선민',
            'R3 윤준성, 응급',
            'R4 김지영',
            'R4 김현태',
            'R4 이동인',
          ].join('\n');
        });
      </script>
      <div class="field field--full">
        <label for="holidays">공휴일 지정</label>
        <div style="display:flex; gap:8px; align-items:flex-start; flex-wrap: wrap;">
          <textarea id="holidays" rows="4" placeholder="예시:&#10;2025-01-01&#10;-2025-02-28 (빼기)"></textarea>
          <div style="display:flex; flex-direction: column; gap:6px;">
            <button type="button" id="load-kr-holidays">공휴일 불러오기</button>
            <button type="button" id="clear-holidays">공휴일 비우기</button>
          </div>
        </div>
      </div>
      <div class="field field--full">
        <label for="unavailable">당직 불가일</label>
        <textarea id="unavailable" rows="5" placeholder="예시:
장주만: 2025-01-07, 2025-01-15
조형우: 2025-01-10 | 2025-01-11
윤성민: 2025-01-04
"></textarea>
      </div>
      <div class="field field--full">
        <label for="dayoff-wish">Day-off 희망일(평일)</label>
        <textarea id="dayoff-wish" rows="4" placeholder="예시:&#10;장주만: 2025-01-09, 2025-01-23&#10;조형우: 2025-01-16"></textarea>
      </div>
      <div class="field field--full">
        <label for="vacations">휴가</label>
        <textarea id="vacations" rows="4" placeholder="예시:&#10;장주만: 2025-01-06~2025-01-12&#10;조형우: 2025-01-20~2025-01-22, 2025-02-03~2025-02-04"></textarea>
      </div>
      <div class="field field--full">
        <label>전일 당직(시작일 전날): 월요일 시작 시 전날 일요일 당직자를 지정하세요</label>
        <div style="display:flex; gap:10px; flex-wrap: wrap; align-items: center;">
          <div>
            <div class="legend">전일 병당</div>
            <input id="prior-byung" type="text" placeholder="이름" />
          </div>
          <div>
            <div class="legend">전일 응당</div>
            <input id="prior-eung" type="text" placeholder="이름" />
          </div>
          <div class="legend">전날이 주말/공휴일이면 시작일은 Day-off(정규/당직 제외)로 처리됩니다.</div>
        </div>
      </div>
      <div class="field">
        <label for="ics-version">ICS 버전명(예: v3)</label>
        <input id="ics-version" type="text" placeholder="v1" />
      </div>
      <div class="field" style="min-width: 380px;">
        <label>ICS 링크 기준 경로(자동)</label>
        <div id="ics-preview" class="legend">시작/종료일과 버전으로 자동 계산됩니다.</div>
        <div class="legend">필요 시 URL 쿼리 ?ics_base=... 로 강제 지정 가능</div>
      </div>
      <div class="field field--full">
        <label>지난달 반영</label>
        <div id="prev-stats-ui"></div>
      </div>

      <div class="field">
        <input type="checkbox" id="toggle-diagnostics" style="width: auto; margin-right: 4px;">
        <label for="toggle-diagnostics" style="display: inline-block; font-weight: normal;">diagnostics</label>
      </div>
      <div class="actions">
        <button id="generate">당직표 생성</button>
        <button id="export-xlsx" disabled>Excel 내보내기</button>
        <button id="export-ics" disabled>ICS 내보내기</button>
      </div>
      <div id="messages" class="messages" aria-live="polite"></div>
    </section>

    <!-- 로딩 오버레이 -->
    <div id="loading-overlay" class="loading-overlay" aria-hidden="true">
      <div class="loading-box">
        <div class="spinner" aria-hidden="true"></div>
        <div class="loading-text">당직표 생성 중… 잠시만 기다려주세요</div>
      </div>
    </div>

    <section>
      <div id="summary" class="summary"></div>
      <div id="report" class="report"></div>
      <div class="legend">역할: 병당 1 · 응당 1 (매일). R3 소아턴은 수요일 당직 제외. R3 응급 태그 인원은 월간 응급 back.</div>
      <div id="roster" class="roster"></div>
    </section>

    <footer>
      <small>오픈소스 초안 — 정교화 필요 시 규칙/데이터 확장 가능</small>
    </footer>

    <script type="module" src="src/app.js"></script>
  </body>
  </html>
