# PSY 당직표를 만들어보자. 

## 사용 방법
- 기간: 시작일 + (종료일 또는 주 수)
- 근무자 목록: `R연차 이름[, 소아][, 응급]`
- 공휴일: YYYY-MM-DD(줄당 1개), `-YYYY-MM-DD`로 제외
- 개인 불가일: `이름: YYYY-MM-DD, YYYY-MM-DD ...`
- 휴가: `이름: YYYY-MM-DD, ...` → 해당 날짜가 속한 주 전체 제외
- 지난달 반영: 각 사람별 병당/응당/Day-off에 대해 정수(자유 입력)
- 생성 → 요약/통계/보정치/당직표 확인 → Excel(.xls) 내보내기(ICS 링크 포함)

## 규칙(핵심)
- 1일 2명: 병당 1, 응당 1 (주말/공휴일 2명, 21h/인)
- 평일 당직 13.5h/인(정규 8h 포함). 다음날 정규 면제(Day-off)
- 주간 상한: soft 72h. 자동 재시도 트리거는 70h(최대 5회 재생성)/ 75h가 hard limit
- 역할/연차 매핑 고정. 응급 back: R3 중 ‘응급’ 태그 1명 고정
- 연차별 당직 슬롯 고정된 형태

### 개인 불가일 처리: 중요! 
- 주말/공휴일 불가일: 그 날 당직 배제
- 평일 불가일: 그 날 당직/정규 제외 + 전날 당직 “강한 선호”를 부여(가능하면 전날 당직으로 해당 평일 Day-off 부여)
- 연차/역할 제약 상 특정 요일만 당직 가능한 경우, 불가일이 무의미할 수 있음(제약 우선) ex.4년차가 목요일을 불가일로 지정할 수는 없음 

### 통계/보정치
- 주별 시간 통계(연차 내), 개인별 통계(병당/응당/총당직/Day-off/시간)
- 다음달 반영: 연차·역할별 여러 명에게 +/− 분배. 이전 보정은 사람/역할별로 먼저 합산 후 재계산
- 병당/응당은 역할별 독립 균형(평균의 floor/ceil). Day-off는 낮은 사람부터 끌어올리는 평균 분배
- 수련시간의 경우 평일과 주말이 21 21.5 시간으로 차이 나기는 하지만 실 근무에는 큰 차이가 없다 판단 
- 따라서 응당/병당 갯수와 day-off 숫자만 맞추면 수련시간은 자동으로 맞춰지게 됨 



### 공휴일
- 버튼으로 대한민국 공휴일(기간 내) 불러오기. 
- 텍스트에서 제외와 추가 가능

### 내보내기
- Excel(.xls): 색상/강조 포함 + 추가 시트 ‘ICS Links’에서 인원별 ICS 링크 제공
  - 주의: Excel 보안 정책상 data: URL은 차단됩니다. 링크는 앱의 ‘ICS 버전’ 입력과 기간(시작/종료일)으로 자동 계산된 경로를 사용합니다(예: `/ics/2025-10/v3/`). 해당 경로에 .ics 파일이 배포되어야 정상 동작합니다(아래 참고).
- ICS ZIP(옵션): 인원별 `이름.ics`를 ZIP으로 한 번에 다운로드

### 파일 이름 규칙(권장)
- Excel: `duty-roster-YYYY-MM-vN.xls` (예: `duty-roster-2025-10-v3.xls`)
  - 앱이 자동으로 이 규칙으로 저장합니다.
- ICS ZIP: `duty-roster-YYYY-MM-vN.zip`
  - GitHub Actions가 태그를 못 읽을 경우 ZIP 파일명에서 `YYYY-MM-vN`을 자동 추출합니다.
- Release 태그: `ics-YYYY-MM-vN` (예: `ics-2025-10-v3`)
  - 태그가 맞으면 이를 우선 사용하고, 아니라면 ZIP 파일명으로 보정합니다.

## ICS 일정 내 캘린더에 추가하기

### 안내
- 모든 일정은 종일(all‑day) 이벤트입니다.
- 자동 업데이트를 원하면 “링크(URL) 구독” 방식을, 한 번만 넣으면 되면 “파일 가져오기”를 사용하세요.

### 링크(URL)로 받은 경우(추천: 자동 업데이트)
- Google 캘린더(웹): 설정 → 캘린더 추가 → URL로 추가 → 공유받은 주소 붙여넣기 → 캘린더 추가
- iPhone/iPad: Google 캘린더(웹)에서 위처럼 URL로 추가 → iOS의 해당 구글 계정과 자동 동기화
- Android: Google 캘린더(웹)에서 URL로 추가 → Android 앱과 자동 동기화
- macOS(캘린더): 파일 → 새 캘린더 구독… → 공유받은 주소 붙여넣기 → 확인
- Outlook 웹: 캘린더 추가 → 웹에서 구독 → 주소 붙여넣기
- Outlook 데스크톱: 캘린더 추가 → 인터넷에서 → 주소 붙여넣기

### 파일(.ics)로 받은 경우(수동 가져오기)
- Google 캘린더(웹): 설정 → 가져오기/내보내기 → 가져오기 → `이름.ics` 선택 → 대상 캘린더 선택 → 가져오기
- iPhone/iPad: 파일 앱/메일에서 `이름.ics` 열기 → 공유 시트 → 캘린더에 추가(또는 Google 웹에서 가져오기 권장)
- Android: 기기/버전에 따라 파일 열기 후 ‘캘린더에 추가’ 가능(미지원 시 Google 웹에서 가져오기)
- macOS(캘린더): `이름.ics` 더블클릭 또는 파일 → 가져오기… → 파일 선택
- Outlook 데스크톱: 파일 → 열기 및 내보내기 → 가져오기/내보내기 → iCalendar(.ics) 가져오기
- Outlook 웹: 캘린더 추가 → 파일에서 업로드 → `이름.ics` 업로드 → 대상 캘린더 선택

### 팁
- 개인별로 캘린더를 분리하고 싶다면, 먼저 비어있는 보조 캘린더를 만들어 그 캘린더로 가져오세요.
- 같은 일정을 여러 번 가져오면 중복될 수 있습니다. 가져오기 전 기존 동일 월의 이벤트를 확인해 주세요.

