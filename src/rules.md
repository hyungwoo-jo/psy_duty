# 최종 스케줄링 알고리즘

현재 스케줄러는 **ILP 모델**과 **점수 기반 평가 시스템**의 두 단계로 동작합니다.

1.  **ILP 모델:** '절대 규칙'만을 이용하여, 규칙을 만족하는 '유효한' 스케줄 후보들을 여러 개 생성합니다.
2.  **점수 기반 평가:** 생성된 여러 후보들 각각에 '나쁨 점수'를 매겨, 점수가 가장 낮은 최적의 스케줄 하나를 최종 선택합니다.

---

## I. ILP 모델: 절대 규칙 (Hard Constraints)

ILP 솔버가 스케줄을 생성할 때 **반드시** 지켜야 하는 규칙 목록입니다. 이 규칙 중 하나라도 위반하면 유효한 스케줄로 간주되지 않습니다.

### 1. 기본 규칙
*   **모든 슬롯 채우기:** 모든 날짜의 모든 당직 슬롯(병당, 응당)은 반드시 한 명에게 배정됩니다.
*   **하루 최대 1회 당직:** 한 근무자는 하루에 최대 한 개의 당직만 설 수 있습니다.
*   **연속 당직 금지:** 한 근무자는 이틀 연속으로 당직을 설 수 없습니다.

### 2. 자격 및 개인 설정 규칙
*   **연차 자격:** 각 당직 슬롯은 요일에 따라 지정된 연차(R1-R4)만 설 수 있습니다.
*   **개인 일정 준수:** 근무자가 미리 지정한 휴가 또는 당직 불가일에는 당직을 배정하지 않습니다.
*   **R3 소아과 수요일 당직 금지:** 소아과 R3는 평일 수요일에 당직을 설 수 없습니다.
*   **Day-off 희망일 처리:** 근무자가 특정 날짜에 Day-off를 희망하면, 그 전날에 당직을 배정하도록 강제합니다.

### 3. 연차별 횟수 규칙
*   **R1 주간 최대 2회 당직 (UI로 제어 가능):**
    *   UI에서 체크된 경우, 해당 주에 R1 휴가자가 한 명도 없을 때만 이 규칙이 강제 적용됩니다.
*   **R3 주간 최대 1회 당직 (UI로 제어 가능):**
    *   UI에서 체크된 경우, 해당 주에 R3 휴가자가 한 명도 없을 때만 이 규칙이 강제 적용됩니다.
*   **R2 주간 최소 1회 당직:**
    *   2년차 근무자는 주당 최소 1회의 당직을 서야 합니다.
*   **비소아과 R3 2명일 때 특별 균형:**
    *   소아과가 아닌 R3가 정확히 2명일 경우, 두 사람의 병당, 응당, Day-off 횟수 차이가 각각 1회를 초과할 수 없습니다.

---

## II. 최종 스케줄 선택 알고리즘 (Scoring)

ILP가 생성한 '유효한' 스케줄 후보들 중에서 '가장 좋은' 스케줄을 선택하기 위한 점수 계산 규칙입니다. **점수가 낮을수록 좋은 스케줄**입니다.

-   **총점 = `시간 초과 점수` + `보정치 위반 점수`**

### 1. 시간 초과 점수
-   주간 근무시간이 72시간을 초과하고 75시간 미만인 경우: **+1점**
-   주간 근무시간이 75시간 이상인 경우: **+2점**

### 2. 보정치 위반 점수
-   **Day-off 보정치:**
    -   '다음 달 보정치'의 절댓값이 1인 경우 (±1): **+0.5점**
    -   '다음 달 보정치'의 절댓값이 1을 초과하는 경우: **`(|보정치| - 1)`점** (예: ±2는 1점, ±3은 2점)
-   **병당/응당 보정치:**
    -   '다음 달 보정치'의 절댓값만큼 점수 부여 (예: ±1은 1점, ±2는 2점)
    -   (단, R3는 이 점수 계산에서 제외됩니다.)