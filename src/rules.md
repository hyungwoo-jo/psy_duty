# ILP 스케줄러 절대 규칙 (Hard Constraints)

이 문서는 ILP 스케줄러가 사용하는 모든 '절대 규칙'의 목록을 기술합니다. 스케줄은 반드시 아래의 모든 규칙을 만족해야 하며, 만약 모든 규칙을 만족하는 해답을 찾을 수 없을 경우 정해진 우선순위에 따라 일부 규칙을 포기(완화)하고 다시 해답을 찾습니다.

---

### 1. 핵심 스케줄링 규칙 (Core Scheduling Rules)

*   **규칙 1.1: 모든 슬롯 채우기**
    *   **설명:** 모든 날짜의 모든 당직 슬롯(병당, 응당)은 반드시 한 명의 근무자에게 배정되어야 합니다.
    *   **기술적 표현:** `SUM_p (x_pds) = 1`

*   **규칙 1.2: 하루에 한 번만 당직**
    *   **설명:** 한 근무자는 특정 날짜에 최대 하나의 당직만 맡을 수 있습니다. (예: 병당과 응당 동시 근무 불가)
    *   **기술적 표현:** `SUM_s (x_pds) <= 1`

*   **규칙 1.3: 연속 당직 금지**
    *   **설명:** 한 근무자는 이틀 연속으로 당직을 설 수 없습니다. (전날 당직자는 다음 날 당직 불가)
    *   **기술적 표현:** `x_p(d)s + x_p(d+1)s' <= 1`

---

### 2. 개인별 근무 자격 규칙 (Individual Eligibility Rules)

*   **규칙 2.1: 연차 자격**
    *   **설명:** 각 당직 슬롯은 요일/주말/공휴일에 따라 지정된 연차(R1-R4)의 근무자만 맡을 수 있습니다.
    *   **기술적 표현:** 변수 생성 시 `person.klass === neededClass` 조건으로 필터링

*   **규칙 2.2: 휴가/당직 불가일 배정 금지**
    *   **설명:** 근무자가 휴가 또는 당직 불가로 미리 지정한 날짜에는 당직을 배정할 수 없습니다.
    *   **기술적 표현:** 변수 생성 시 `person.vacationDays`, `person.dutyUnavailable` 조건으로 필터링

*   **규칙 2.3: Day-off 희망일 전날 당직 강제**
    *   **설명:** 근무자가 특정 날짜에 Day-off를 희망하면, 그 전날에 반드시 당직을 서야 합니다.
    *   **기술적 표현:** `SUM_s (x_p(d_prev)s) = 1`

*   **규칙 2.4: R3 소아과 수요일 당직 금지**
    *   **설명:** 소아과 R3는 평일 수요일에 당직을 설 수 없습니다.
    *   **기술적 표현:** 변수 생성 시 `date.getDay() === 3 && person.klass === 'R3' && person.pediatric` 조건으로 필터링

---

### 3. 근무량 및 시간 규칙 (Workload & Hour Rules)

*   **규칙 3.1: 주간 최대 근무 시간 제한**
    *   **설명:** 한 근무자의 주간 총 근무 시간은 **72시간**을 초과할 수 없습니다.
    *   **예외 (Strict 모드):** 만약 특정 주에 같은 연차의 다른 근무자 중 휴가자가 한 명이라도 있으면, 해당 연차 전원의 상한선이 해당 주에 한해 **80시간**으로 완화됩니다.
    *   **완화 시 (Dropped):** 이 규칙이 완화될 경우, 모든 근무자에게 **절대 상한선 80시간**이 일괄적으로 적용됩니다. 즉, 어떤 경우에도 주 80시간을 초과하는 스케줄은 생성되지 않습니다.
    *   **기술적 표현:** `SUM_d_in_week(Hours) <= 72 (or 80)`

*   **규칙 3.2: R1 주간 당직 횟수 제한**
    *   **설명:** R1 근무자는 주당 2회를 초과하여 당직을 설 수 없습니다.
    *   **예외:** 해당 주에 R1 휴가자가 없을 경우에만 강제 적용됩니다.
    *   **기술적 표현:** `SUM_d_in_week(Duties) <= 2`

*   **규칙 3.3: R3 주간 당직 횟수 제한**
    *   **설명:** R3 근무자는 주당 1회를 초과하여 당직을 설 수 없습니다.
    *   **예외:** 해당 주에 R3 휴가자가 없을 경우에만 강제 적용됩니다.
    *   **기술적 표현:** `SUM_d_in_week(Duties) <= 1`

---

### 4. 공평성 및 균형 규칙 (Fairness & Balancing Rules)

*   **규칙 4.1: 역할별 당직 횟수 균형 (비 R3)**
    *   **설명:** R1, R2, R4는 연차 내에서 역할(병당/응당)별 총 당직 횟수가 [평균 - 편차] ~ [평균 + 편차] 범위 내에 있어야 합니다. (편차는 보통 1 또는 2)
*   **규칙 4.2: 통합 당직 횟수 균형 (R3)**
    *   **설명:** R3는 병당/응당 구분 없이 총 당직 횟수가 일정 범위 내에 있어야 합니다.
*   **규칙 4.3: Day-off 횟수 균형 (비 R3)**
    *   **설명:** R1, R2, R4는 총 Day-off 횟수가 [평균 - 3] ~ [평균 + 3] 범위 내에 있어야 합니다.
*   **규칙 4.4: R3 Day-off 횟수 균형**
    *   **설명:** R3 근무자들 간의 Day-off 횟수 차이가 1회를 초과할 수 없습니다.
*   **규칙 4.5: R3 비소아과 2명일 때의 특별 균형**
    *   **설명:** 소아과가 아닌 R3가 정확히 2명일 경우, 두 사람의 병당, 응당, Day-off 횟수 차이가 각각 1회를 초과할 수 없습니다.